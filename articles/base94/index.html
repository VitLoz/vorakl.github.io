<!DOCTYPE html><html lang=en> <head><meta charset=utf-8><title>Convert binary data to a text with the lowest overhead :: Vorakl's notes</title><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=robots content=all><link href=https://vorakl.com/articles/base94/ rel=canonical><meta name=description content="A binary-to-text encoding with any radix from 2 to 94"><!--[if lt IE 9]>
    <script src="https://vorakl.com/theme/html5.js?v=15614009773"></script>
    <![endif]--><link rel=stylesheet href="https://vorakl.com/theme/bootstrap-pygments.bundle.min.css?v=15614009773"><link rel=alternate type=application/atom+xml href=https://vorakl.com/atom.xml title="Vorakl's notes"><link rel="shortcut icon" href="/favicon.ico?v=15614009773"><meta name=apple-mobile-web-app-title content="Vorakl's notes"><meta name=application-name content="Vorakl's notes"></head> <body> <div class=navbar> <div class=navbar-inner> <div class=container> <a href=https://vorakl.com/ class=brand>Vorakl's notes</a> <a class="btn btn-navbar" data-toggle=collapse data-target=.nav-collapse> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </a> <div class=nav-collapse> <ul class="nav pull-right"> <!-- <li class="divider-vertical"></li> --> <li><a href=https://vorakl.com/pages/reading/ >Reading</a></li> <li><a href=https://vorakl.com/pages/projects/ >Projects</a></li> <li><a href=https://vorakl.com/pages/contacts/ >Contacts</a></li> <li><a href=https://vorakl.com/pages/about/ >About</a></li> <!-- <li class="divider-vertical"></li> --> </ul> </div> </div> </div> </div> <div class=container> <div class=content> <div class=row> <div class=span9> <div class=article> <div class=content-title> <h1>Convert binary data to a text with the lowest overhead</h1> <div class="well small">on 2020-04-18 in <a href=https://vorakl.com/categories/article/ >article</a> about <a href=https://vorakl.com/tags/cs/ >cs</a> <a href=https://vorakl.com/tags/programming/ >programming</a> <a href=https://vorakl.com/tags/binary-to-text/ >binary-to-text</a> <a href=https://vorakl.com/tags/encoding/ >encoding</a> ~5 min read </div> <p><h3>A binary-to-text encoding with any radix from 2 to 94</h3></p> </div> <div><p>This article is about <a class="reference external" href=https://en.wikipedia.org/wiki/Binary-to-text_encoding>binary/text converters</a>, the most popular implementations, and a non-standard approach which uses <a class="reference external" href=https://merrigrove.blogspot.com/2014/04/what-heck-is-base64-encoding-really.html>the Place-Based Single Number Encoding</a> by representing a file as one big number and then converting it to another big number with any non-256 (1 byte/8 bit) radix. To make it applicable for a practical use, it makes sense to limit a radix (base) to 94 for matching numbers to all possible printable symbols within 7 bits <a href=https://www.ascii-code.com/ class="reference external">ASCII</a> table. It is likely a theoretical prototype and carries a pure academical flavor as the time and space complexities make it applicable only to small files (up to a few tens of kilobytes), although it allows one to choose any base with no dependencies on powers of two, e.g. 7 or 77.</p> <div class=section id=background> <h2>Background</h2> <p>The main purpose of such converters is to put a binary file, represented by 256 different symbols (radix-256, 1 byte, 2^8), to a form applicable for sending over a channel with a limited for transmission range of supported symbols. A good example is any text-based network protocol, like HTTP or SMTP, where all transmitted binary data has to be reversibly converted to a pure text form with no control symbols in it. As it's known, the ASCII codes from 0 to 31 are considered to be the control characters, and that's why they will definitely be lost while transmitting over any logical channel that doesn't allow endpoints to transmit full 8-bit bytes (binary) with codes from 0 to 255. This limits the number of allowed symbols to less than 224 (256-32), but in fact it's limited by only first 128 standartized symbols in the ASCII table and even more.</p> <div class=line-block> <div class=line><br></div> </div> <p>The standard solution nowadays for this purpose is the Base64 algorithm defined in the <a class="reference external" href=https://tools.ietf.org/html/rfc4648>RFC 4648</a> (easy reading). It also describes Base32 and Base16 as possible variations. The key point here: they all share the same characteristic as they are all powers of two. The wider a range of supported symbols (codes) the more space efficient result of conversion is. It will be bigger anyway, but the only question is how much bigger. For example, Base64 encoding gives an approximately 33% bigger output, because 3 input (8 valued bits) bytes are translated to 4 output (6 valued bits, 2^6=64) bytes. So, the ratio is always 4/3 that is the output is bigger by 1/3 or 33.(3)%. Practically speaking, Base32 is very inefficient because it implies translating 5 input (8 valued bits) bytes to 8 output (5 valued bits, 2^5=32) bytes and the ratio is 8/5, that is output is bigger by 3/5 or 60%. In this context, it is hard to consider any sort of efficiency of Base16 as its output size is bigger by 100% (each byte with 8 valued bits is represented by two 4 valued bits bytes, also know as the <a class="reference external" href=https://en.wikipedia.org/wiki/Nibble>nibbles</a>, 2^4=16). It is not even a translation, but rather just a representation of an 8-bit byte in the hexadecimal view.</p> <div class=line-block> <div class=line><br></div> </div> <p>If you're curious, how these input/output byte ratios were calculated for the Base64/32/16 encodings, then the answer is the LCM (Least Common Multiple). Let's calculate them by ourselves, and for this, we'll need one more function, GCD (Greatest Common Divisor)</p> <div class=line-block> <div class=line><br></div> </div> <ol class="arabic simple"> <li><dl class="first docutils"> <dt>Base64 (Input: 8 bits, Output: 6 bits):</dt> <dd><ul class="first last"> <li>LCM(8, 6) = 8*6/GCD(8,6) = 24 bit</li> <li>Input: 24 / 8 = 3 bytes</li> <li>Output: 24 / 6 = 4 bytes</li> <li>Ratio (Output/Input): 4/3</li> </ul> </dd> </dl> </li> <li><dl class="first docutils"> <dt>Base32 (Input: 8 bits, Output: 5 bits):</dt> <dd><ul class="first last"> <li>LCM(8, 5) = 8*5/GCD(8,5) = 40 bit</li> <li>Input: 40 / 8 = 5 bytes</li> <li>Output: 40 / 5 = 8 bytes</li> <li>Ratio (Output/Input): 8/5</li> </ul> </dd> </dl> </li> <li><dl class="first docutils"> <dt>Base16 (Input: 8 bits, Output: 4 bits):</dt> <dd><ul class="first last"> <li>LCM(8, 4) = 8*4/GCD(8,4) = 8 bit</li> <li>Input: 8 / 8 = 1 byte</li> <li>Output: 8 / 4 = 2 bytes</li> <li>Ratio (Output/Input): 2/1</li> </ul> </dd> </dl> </li> </ol> </div> <div class=section id=what-s-the-point> <h2>What's the point?</h2> <p>The point is the following. What if a channel is able to transmit only just a few different symbols, like 9 or 17. That is, we have a file represented by 256 symbols alphabet (a normal 8-bit byte), we are not limited by computational power or memory constraints on both sides, but we are able to send only 7 different symbols instead of 256? Base64/32/16 are not a solution here. Then, Base7 is the only possible output format.</p> <div class=line-block> <div class=line><br></div> </div> <p>Another example, what if an amount of transmitted data is a concern for a channel? Base64, as it was shown, increases the data by 33% no matter what is transmitted, always. For instance, Base94 increases output by only 22%.</p> <div class=line-block> <div class=line><br></div> </div> <p>It might seem that Base94 is not the limit. If the first 32 ASCII codes are control characters and there are 256 codes in total, what stops one from using an alphabet of 256 - 32 = 224 symbols? There is a reason. Not all of 224 ASCII codes have printable characters. In general, only 7 bits (0..127) are standardized and the rest (128..255) is used for the variety of locales, e.g. Koi8-R, Windows-1251, etc. That means, only 128 - 32 = 96 are available in the standardized range. In addition, the ASCII code 32 is the space character and 127 doesn't have a visible character either. Hence, 96 - 2 gives us that 94 printable characters which have the same association with their codes on all possible machines.</p> </div> <div class=section id=solution> <h2>Solution</h2> <p><a class="reference external" href=https://github.com/vorakl/base94>This solution</a> is pretty simple but this simplicity also puts a significant computational constraint. The whole input file can be treated as one big number with a radix (base) 256. It might easily be areally big number required thousands of bits. Then, we just need to convert this big number to a different base. That's it. And Python3 makes it even simpler! Usually, conversions between different bases are done via an intermediate Base10. The good news is that Python3 has built-in support for big numbers calculations (it is integrated with Int), and the Int class has a method that reads any number of bytes and automatically represents them in a big Base10 number with a desired endian. So, all these complications are able to be implemented in just two lines of code, which is pretty amazing!</p> <div class=highlight><pre><span></span><span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;inpit_file&#39;</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
    <span class=n>in_data</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>(),</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</pre></div> <p>where in_data is our big number with Base10. These are just two lines but this is the point where most computation happens and the most time is consumed. So now, convert it to any other base as it's usually done with normal small decimal numbers.</p> <!-- Links --> </div> </div> </div> <div class=article> <p>Share on <a href="https://twitter.com/intent/tweet?text=Convert%20binary%20data%20to%20a%20text%20with%20the%20lowest%20overhead:%20A%20binary-to-text%20encoding%20with%20any%20radix%20from%202%20to%2094&url=https://vorakl.com/articles/base94/">Twitter</a></p> </div> </div> <div class=span3> <div class=well style="padding: 8px 0; background-color: #FBFBFB;"> <ul class="nav nav-list"> <li class=nav-header> Site </li> <li><a href=https://vorakl.com/articles/ ><img class=iconmenu src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAn1BMVEVHcEzuQyFDqUP/dlSpu8z////d7v+pqanuQyHMIQCH7oeampqFhYVUu1S7dmWpqallmMz3XTv1WTfu7u6YzP/MzMzdMhDVh392dnbbMA7vRiTTe2/YLQvVKgjSaVnp9P/kORfk8f/RJgR3qt7u9v/QVD/g7/9votbOIwHWKwnz+f9/suXNLQ5pnNDPPyXMIQD4/P+Guu38/v+UyPuOwvXUfcTEAAAACnRSTlMA////////gL+/p4E1rgAAAJNJREFUeAFNygMOxAAUhOF6rdq2df+z7dT9i0m+PAJdPpfToIfw2Add9af05H8/HqNfAS79Vt80msYFZKTIfsm1DNCkvmVqsqyZlp82AJE9JQKGnqKoF15MPwDGlrrfX/NLtSOgy5m9vAMUIcOy6xsWgMA5LpwAkHjHhZcAqvi4iCvAlzv1BdzKOrINRTHsqC5vxB8wAwzldAteLAAAAABJRU5ErkJggg==" alt=[Archive]>Archive</a></li> <li><a href=https://vorakl.com/allarticles/ ><img class=iconmenu src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAn1BMVEVHcEzuQyFDqUP/dlSpu8z////d7v+pqanuQyHMIQCH7oeampqFhYVUu1S7dmWpqallmMz3XTv1WTfu7u6YzP/MzMzdMhDVh392dnbbMA7vRiTTe2/YLQvVKgjSaVnp9P/kORfk8f/RJgR3qt7u9v/QVD/g7/9votbOIwHWKwnz+f9/suXNLQ5pnNDPPyXMIQD4/P+Guu38/v+UyPuOwvXUfcTEAAAACnRSTlMA////////gL+/p4E1rgAAAJNJREFUeAFNygMOxAAUhOF6rdq2df+z7dT9i0m+PAJdPpfToIfw2Add9af05H8/HqNfAS79Vt80msYFZKTIfsm1DNCkvmVqsqyZlp82AJE9JQKGnqKoF15MPwDGlrrfX/NLtSOgy5m9vAMUIcOy6xsWgMA5LpwAkHjHhZcAqvi4iCvAlzv1BdzKOrINRTHsqC5vxB8wAwzldAteLAAAAABJRU5ErkJggg==" alt="[All posts]">All posts</a></li> <li><a href=https://vorakl.com/categories/ ><img class=iconmenu src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAflBMVEVHcEzMmGXKlmPy0bL/5czHk2Dvzqz84cfHk2DEkF353MDAjFn11re7h1Twzq7jvJe3g1Drx6Peto7Jm2+yf0zy0rLlv5jClWjgt42uekepdkPbsIOkcT7Wp3qgbTrSoXGdajfPnGqaZzSYZTKbaDWeaziibzyndEGreEWwfEnOm7M9AAAAJHRSTlMA/////////7///////////////////////////////////7/uB1ikAAAAW0lEQVR4AYXNpQEDURBF0fs+6pAP9F9TfLCCZeY9angEopDREEaCLEvbglc90YxY58RQ5sxKQSkVOas6z6hE56jYQCV19k/pSPvFXva/7BaeDN30UOXNJaswlQOK2Bmf70dgXAAAAABJRU5ErkJggg==" alt=[categories]>Categories</a></li> <li><a href=https://vorakl.com/tags/ ><img class=iconmenu src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABaUlEQVR4AY2TA7IeQRRGexMpZxnZQryM2LZt27Zt27Ztc3TyTvymfk3Vufi+W6PuDtNOsbcKcuyt065hqIQw5URK/nr8IUO9ohtMPBqRZrDh1BMaTzuF2f7huwy9sjcYd+grcQpmhT+93Hub/tWLEUbv/8S3BA7ejbA224vcfp2gXvQGw3e/23vjZczniGowLSDW+lVzFLyBYfD2V1x9FvHhG0g0MZDtaYBYq+k7V/AG0n/zMy4++c6bL/BxVCDZ1QBONTbbq+vjXMEbSK91Dzn76BsvPsOLgYFobS3YXcdsr66PcwVvIN1W3uXk/a88/Qj3ewS+zqoBS2ua7dX1ca7gDaTT0pscu/uFR+/hWvvA5zH+0F/ZXl3fuaLr227hVQ7f/sz9d3C+RfA/iLWaHs44XJTW8y5x8OYn7r71fwaxVkMv9wmFaTH7PPtufOT2G8QatcI/sQhNZ5xh3/WPgnV+GSvCgyZ5/QeQVjev4io8YwAAAABJRU5ErkJggg==" alt=[tags]>Tags</a></li> <li><a href=https://vorakl.com/atom.xml rel=alternate><img class=iconmenu src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB2ElEQVR4AaWTA5AcURiE5y62bZtlOy7Gtm3btm3bPNu2ba0Hnengxby/qqt6//d17+5A6rtgUKkkTP72mg4Fu+qgaG99lBxqAuPR5jCfaAWKnjuekSH7TUHu1hoOpuOtgJu9/0pkmREFmRurQ7veEzjfETjR6rciQ5YZUZC2rhrUK92gHmsBqApQlAgt5hE0h2VQz/fi/huRZUYUJK6sAvliZ1j1/6n4HIQaeQdafiw4avxLyPeH80yILDOiIHZpZVjPdYBxX4NvZH29CGpOONQMf1huDxF7ssyIgogFFWE+1QaFO2sDihVKmjfMzltQfKInDHdGQMkOgy3mGYoOtwMZssyIguDZFWDS/1vu1uowue+FLf4tOJbQm8g/0hWGZ3PBKXk6G2TIMiMK/KaVg0H/bxkbKgkVv1j6MfRuPT9Dzo2GWS+kJ8uMKPCaVBbF+xsiZU05KAVJKHi2iB7mmNewJnvQwxh4BXJeHD1ZMCMKXMfao3BPPSSssANHLkikR6Hjdmiy5aN/twWaKtOTBTOiwGmUHQr0i5O+viLilkm/FRmyzIiCt8Mkh/D5FfmM/5XIMiMKqNdDJAeHERLcxtnDZ0pZBM0qj7B5FSl67ngGMmS/fRtLofdMUk3gzHxD5AAAAABJRU5ErkJggg==" alt=[rss]>RSS feed</a></li> </ul> </div> </div> </div> </div> <footer> <div class=container> <div class=row> <div class=span5> <span class=pull-left> &copy; 2020 <a href=https://vorakl.com/pages/about/ >vorakl</a> All Rights Reserved </span> </div> <div class=span3> <a href=https://feeds.feedburner.com/voraklsnotes/atom><img src="https://feeds.feedburner.com/~fc/voraklsnotes/atom?bg=2e435e&fg=FFFFFF&anim=0" height=26 width=88 style=border:0 alt></a> </div> <div class=span4> <div class=pull-right> Powered by <a href=https://github.com/getpelican/pelican>Pelican</a> and <a href=https://aves.cf/ >Aves</a> theme </div> </div> </div> </div> </footer> </div> <script src="https://vorakl.com/theme/jquery-bootstrap-collapse.bundle.min.js?v=15614009773"></script> </body> </html>